# MVP 开发文档 (Windows 11 磁盘占用扫描工具)

> 目标: 先交付一个可运行的 MVP, 支持基础扫描与目录钻取, 便于中途测试与迭代。

## 1. MVP 范围
### 必做(第一阶段)
- Electron + Node.js/TypeScript 桌面壳
- 单个 EXE 打包(可运行)
- 盘符选择
- 当前目录列表展示(目录 + 文件, 卡片化)
- 进入目录(钻取) + 返回上一级
- 扫描进度显示(当前层进度, 可中断)
- 目录大小递归统计(进入目录时单次遍历子树, 汇总所有子目录大小)
- 先展示当前层列表, 扫描中增量更新大小
- 扫描结果缓存, 返回上一级不重复扫描
- 列表虚拟化(仅渲染可视区域), 大目录不卡顿
- 排序: 按大小降序
- 打开所在位置(资源管理器)
- 搜索: 当前列表内筛选
- 指定目录扫描(目录选择器)

### 可延后(第二阶段)
- 更完善的进度估算(总文件数/耗时预估)
- 更精细的权限提示与错误处理
- UI 美化与动效

## 2. 技术选型
- 桌面壳: Electron
- 前端 UI: HTML/CSS/TypeScript + 简单状态管理
- 后端(本地): Node.js (主进程)
- 进程通信: IPC

## 3. 目录结构(建议)
- app/
  - main/ (Electron 主进程)
  - renderer/ (Web UI)
  - shared/ (类型与工具)
- scripts/ (打包与开发脚本)

## 4. 关键模块与职责
### 4.1 主进程 (Scanner Service)
- 扫描目录并返回树形结果
- 计算目录大小(单次遍历)
- 进度回传 + 中断能力
- 打开所在位置(Explorer)

### 4.2 渲染进程 (UI)
- 盘符选择
- 卡片网格列表
- 面包屑 + 返回上一级
- 进度条 + 中断按钮
- 点击目录触发扫描

## 5. MVP 里程碑
### M1: 项目骨架 & 基础 UI
- Electron 启动 & 热更新
- UI 页面框架(盘符选择 + 卡片布局)

### M2: 扫描引擎 MVP
- 主进程扫描目录
- IPC 返回结果
- UI 渲染目录/文件列表

### M3: 进度 & 中断
- 扫描进度回传
- 中断按钮可用

### M4: 打开所在位置
- 目录: 打开文件夹
- 文件: Explorer 中选中

### M5: EXE 打包
- Windows 下打包单个 EXE
- 基础运行验证

## 6. CI 打包
- GitHub Actions: workflow_dispatch / tag(v*) 自动打包
- 产物输出: dist/*.exe (portable)

## 7. 测试策略
### mac (逻辑层)
- 使用本地目录做扫描测试
- 测试中断/进度回传/排序
- 验证 UI 交互(盘符选择、卡片展示、返回上级)
- 验证缓存生效(返回上一级不重复扫描)

### Windows (集成测试)
- 真实权限目录测试(C:\\Windows)
- Explorer 打开位置功能
- EXE 打包运行测试

## 8. MVP 验收标准
- 可选择盘符并展示当前目录文件/目录卡片
- 点击目录可进入并显示其子目录/文件大小
- 进度条更新, 可中断
- 支持返回上一级
- 右键或按钮打开 Explorer 中的位置
- 可打包成单个 EXE

## 9. 风险与对策
- 大目录扫描慢 -> 后台扫描 + 增量更新
- 文件系统权限不足 -> 标记“无权限/未扫描”
- 符号链接循环 -> 不跟随 reparse point
